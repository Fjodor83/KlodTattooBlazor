@inherits LayoutComponentBase
@inject NavigationManager NavigationManager
@inject IJSRuntime JS
@implements IDisposable

<div class="page-layout d-flex flex-column min-vh-100">
    <!-- Header/Navbar - Fixed Top -->
    <header class="fixed-top navbar-container">
        <NavMenu IsHomePage="@IsDynamicNavbar" />
    </header>

    <!-- Main Content Area -->
    <main role="main" class="@(IsHomePage ? "hero-page-wrapper" : "page-content-wrapper") flex-grow-1">
        @Body
    </main>

    <!-- Footer -->
    <footer>
        <Footer />
    </footer>
</div>

<!-- Cookie Consent -->
<CookieConsent />

@code {
    // Make navbar dynamic on ALL pages (transparent → glass on scroll)
    private bool IsDynamicNavbar => true;
    private bool IsHomePage => NavigationManager.ToBaseRelativePath(NavigationManager.Uri).Trim('/') == "";

    protected override void OnInitialized()
    {
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        StateHasChanged();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Initialize EmailJS
            await JS.InvokeVoidAsync("eval", @"
                (function(){
                    if (!window.emailjs) {
                        var script = document.createElement('script');
                        script.type = 'text/javascript';
                        script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js';
                        script.onload = function() {
                            emailjs.init('YOUR_EMAILJS_PUBLIC_KEY_HERE');
                        };
                        document.head.appendChild(script);
                    }
                })();
            ");
        }
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}
